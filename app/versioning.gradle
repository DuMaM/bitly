def getVersionCodeFromGit() {
    def stdout = ''
    try {
        project.logger.lifecycle "Fetching version code from ${project.projectDir}"
        stdout = new ByteArrayOutputStream()
        exec {
            commandLine "git", "rev-list", "HEAD", "--count"
            standardOutput = stdout
        }

        def ret = Integer.parseInt(stdout.toString().trim())
        project.logger.lifecycle "Current code version: $ret"
        return ret
    } catch (exception) {
        project.logger.error "Error: " + exception.getMessage()
        return 1
    }
}

def getVersionNameFromGit() {
    def stdout = ''
    try {
        stdout = new ByteArrayOutputStream()
        exec {
            commandLine "git", "describe", "--tags", "--dirty"
            standardOutput = stdout
        }
        def ret = stdout.toString().trim()
        project.logger.lifecycle "Current name version: $ret"
        return ret
    } catch (exception) {
        project.logger.error "Error: " + exception.getMessage()
        return "0.0.1"
    }
}

// Export methods by turning them into closures
ext {
    getVersionCodeFromGit = this.&getVersionCodeFromGit
    getVersionNameFromGit = this.&getVersionNameFromGit
}
